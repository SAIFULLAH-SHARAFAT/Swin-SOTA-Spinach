flowchart TD
    A0[Start: main()]
    A0 --> A1[Initialize Config: Paths, Classes, Hyperparams]
    A1 --> A2[Set Random Seed]
    A2 --> A3[Setup Logging: Console & File]
    A3 --> A4[Save Config as JSON]
    A4 --> B1[Create Datasets: Train, Val, Test]
    B1 --> B2[Apply Data Augmentations]
    B2 --> B2a[Train Transforms: Crop, Flip, Jitter, Blur, Rotate, Erase]
    B2 --> B2b[Test Transforms: Resize, CenterCrop, Normalize]
    B2 --> B3[TTA Transforms: hflip, vflip]
    B1 --> C1[Create WeightedRandomSampler]
    C1 --> C2[Build DataLoaders]
    C2 --> D1[Create Model (SwinV2)]
    D1 --> D2[Send to DEVICE]
    D2 --> D3[Setup Optimizer (AdamW)]
    D3 --> D4[Setup Scheduler (CosineAnnealingLR)]
    D4 --> D5[Setup GradScaler (Mixed Precision)]
    D5 --> D6[Setup Losses: CrossEntropy, SupCon, Mixup/Cutmix]
    D6 --> E1[Train Loop (Epochs & Batches)]
    E1 --> E2[Forward, Loss, Backward, Step, Metrics]
    E1 --> F1[Validation]
    F1 --> F2[Metrics, Save, Early Stop]
    F2 --> G1[Testing & TTA]
    G1 --> G2[Final Metrics, Plots, Reports]
    G2 --> H1[GC Collect, CUDA Empty Cache]
    H1 --> I1[End]
